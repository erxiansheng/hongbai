<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Á∫¢ÁôΩÊú∫Âèå‰∫∫ÂØπÊàò</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="scanlines"></div>
    <div class="crt-overlay"></div>
    
    <div class="app-container">
        <!-- È°∂ÈÉ®Ë£ÖÈ•∞ -->
        <div class="console-top">
            <div class="console-stripe red"></div>
            <div class="console-stripe gold"></div>
        </div>

        <header class="nes-header">
            <div class="logo-container">
                <div class="controller-icon left">üéÆ</div>
                <h1>FAMILY COMPUTER</h1>
                <div class="controller-icon right">üéÆ</div>
            </div>
            <p class="subtitle">Â§ö‰∫∫ËÅîÁΩëÂØπÊàòÁ≥ªÁªü</p>
        </header>

        <main class="main-content">
            <!-- Ê®°ÂºèÈÄâÊã©Èù¢Êùø -->
            <section id="mode-panel" class="panel mode-panel">
                <div class="panel-header">
                    <span class="panel-led"></span>
                    <h2>ÈÄâÊã©Ê®°Âºè</h2>
                </div>
                <div class="panel-body">
                    <div class="mode-cards">
                        <div class="mode-card" id="single-mode">
                            <div class="mode-icon">üéÆ</div>
                            <div class="mode-title">Âçï‰∫∫Ê∏∏Êàè</div>
                            <div class="mode-desc">Áã¨Ëá™‰∫´ÂèóÁªèÂÖ∏</div>
                        </div>
                        <div class="mode-card" id="create-mode">
                            <div class="mode-icon">üè†</div>
                            <div class="mode-title">ÂàõÂª∫ÊàøÈó¥</div>
                            <div class="mode-desc">ÈÇÄËØ∑Â•ΩÂèãÂä†ÂÖ•</div>
                        </div>
                        <div class="mode-card" id="join-mode">
                            <div class="mode-icon">üö™</div>
                            <div class="mode-title">Âä†ÂÖ•ÊàøÈó¥</div>
                            <div class="mode-desc">ËæìÂÖ•ÊàøÈó¥Âè∑</div>
                        </div>
                    </div>

                    <!-- Âä†ÂÖ•ÊàøÈó¥Ë°®Âçï -->
                    <div id="join-form" class="join-form hidden">
                        <label>ËæìÂÖ•ÊàøÈó¥Âè∑</label>
                        <div class="input-group">
                            <input type="text" id="room-input" placeholder="XXXXXX" maxlength="6" autocomplete="off">
                            <button id="confirm-join-btn" class="nes-btn primary">Âä†ÂÖ•</button>
                        </div>
                        <button id="back-to-mode-btn" class="nes-btn mini">ËøîÂõû</button>
                    </div>

                    <!-- ÊàøÈó¥‰ø°ÊÅØ -->
                    <div id="room-info" class="room-info hidden">
                        <div class="room-code-display">
                            <label>ÊàøÈó¥Âè∑</label>
                            <div class="code-box">
                                <span id="room-code"></span>
                            </div>
                            <button id="copy-room-btn" class="nes-btn mini">üìã Â§çÂà∂</button>
                        </div>
                    </div>

                    <div id="connection-status" class="connection-status hidden">
                        <span class="status-indicator"></span>
                        <span id="status-text">Êú™ËøûÊé•</span>
                    </div>
                </div>
            </section>

            <!-- ÊàøÈó¥Èù¢ÊùøÔºàÂê´Â∫ß‰ΩçÔºâ -->
            <section id="room-panel" class="panel room-panel hidden">
                <div class="panel-header">
                    <span class="panel-led active"></span>
                    <h2>Ê∏∏ÊàèÊàøÈó¥ <span id="room-code-display"></span></h2>
                </div>
                <div class="panel-body">
                    <!-- Á∫¢ÁôΩÊú∫ÂíåÂ∫ß‰ΩçÂå∫Âüü -->
                    <div class="room-scene">
                        <!-- ÁîµËßÜÊú∫ -->
                        <div class="tv-unit">
                            <div class="tv-screen" id="tv-preview">
                                <div class="tv-static">ËØ∑ÈÄâÊã©Ê∏∏Êàè</div>
                            </div>
                            <div class="tv-stand"></div>
                        </div>

                        <!-- Á∫¢ÁôΩÊú∫‰∏ªÊú∫ -->
                        <div class="famicom-console" id="famicom">
                            <div class="fc-body">
                                <div class="fc-cartridge-slot" id="cartridge-slot">
                                    <div class="fc-cartridge hidden" id="cartridge">
                                        <div class="cart-label" id="cart-label">Ê∏∏Êàè</div>
                                    </div>
                                </div>
                                <div class="fc-controls">
                                    <div class="fc-power-btn" id="power-btn">
                                        <span>POWER</span>
                                    </div>
                                    <div class="fc-reset-btn">
                                        <span>RESET</span>
                                    </div>
                                </div>
                                <div class="fc-stripe"></div>
                            </div>
                        </div>

                        <!-- Áé©ÂÆ∂Â∫ß‰Ωç -->
                        <div class="players-area">
                            <div class="player-seat" data-seat="1">
                                <div class="seat-chair">
                                    <div class="chair-back"></div>
                                    <div class="chair-seat"></div>
                                </div>
                                <div class="seat-player empty" id="seat-1">
                                    <div class="player-avatar">üë§</div>
                                </div>
                                <div class="seat-label">P1</div>
                                <div class="seat-controller">üéÆ</div>
                            </div>
                            <div class="player-seat" data-seat="2">
                                <div class="seat-chair">
                                    <div class="chair-back"></div>
                                    <div class="chair-seat"></div>
                                </div>
                                <div class="seat-player empty" id="seat-2">
                                    <div class="player-avatar">üë§</div>
                                </div>
                                <div class="seat-label">P2</div>
                                <div class="seat-controller">üéÆ</div>
                            </div>
                            <div class="player-seat" data-seat="3">
                                <div class="seat-chair">
                                    <div class="chair-back"></div>
                                    <div class="chair-seat"></div>
                                </div>
                                <div class="seat-player empty" id="seat-3">
                                    <div class="player-avatar">üë§</div>
                                </div>
                                <div class="seat-label">P3</div>
                                <div class="seat-controller">üéÆ</div>
                            </div>
                            <div class="player-seat" data-seat="4">
                                <div class="seat-chair">
                                    <div class="chair-back"></div>
                                    <div class="chair-seat"></div>
                                </div>
                                <div class="seat-player empty" id="seat-4">
                                    <div class="player-avatar">üë§</div>
                                </div>
                                <div class="seat-label">P4</div>
                                <div class="seat-controller">üéÆ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê∏∏ÊàèÊêúÁ¥¢ÈÄâÊã© -->
                    <div class="game-selector">
                        <div class="search-box">
                            <input type="text" id="game-search" placeholder="üîç ÊêúÁ¥¢Ê∏∏Êàè..." autocomplete="off">
                        </div>
                        <div class="game-results" id="game-results"></div>
                        <div class="upload-inline">
                            <label for="rom-upload" class="upload-btn-inline">
                                üìÅ ‰∏ä‰º†ROM
                            </label>
                            <input type="file" id="rom-upload" accept=".nes" hidden>
                            <span id="upload-filename"></span>
                        </div>
                    </div>

                    <!-- ÂºÄÂßãÊåâÈíÆ -->
                    <button id="start-game-btn" class="nes-btn primary large full-width" disabled>
                        ÊèíÂÖ•Âç°Â∏¶Âπ∂ÂºÄÂßã
                    </button>
                </div>
            </section>

            <!-- Ê∏∏ÊàèÁîªÈù¢ -->
            <section id="game-screen" class="game-screen hidden">
                <div class="screen-wrapper">
                    <div class="screen-bezel">
                        <div class="screen-inner">
                            <canvas id="nes-canvas" width="256" height="240"></canvas>
                        </div>
                        <div class="screen-reflection"></div>
                    </div>
                </div>
                
                <div class="player-bar">
                    <div class="player-badge p1">
                        <span class="badge-label">P1</span>
                        <span id="p1-name" class="badge-name">-</span>
                    </div>
                    <div class="player-badge p2">
                        <span class="badge-label">P2</span>
                        <span id="p2-name" class="badge-name">-</span>
                    </div>
                    <div class="game-title" id="current-game-title">Ê∏∏Êàè‰∏≠</div>
                    <div class="player-badge p3">
                        <span class="badge-label">P3</span>
                        <span id="p3-name" class="badge-name">-</span>
                    </div>
                    <div class="player-badge p4">
                        <span class="badge-label">P4</span>
                        <span id="p4-name" class="badge-name">-</span>
                    </div>
                </div>

                <!-- Áé©ÂÆ∂ÊåâÈîÆÊòæÁ§∫Âå∫Âüü -->
                <div class="players-input-display">
                    <div class="player-input-panel" data-player="1">
                        <div class="input-panel-header">
                            <span class="panel-player-label p1">P1</span>
                            <span class="panel-latency" id="latency-p1">--ms</span>
                        </div>
                        <div class="mini-controller">
                            <div class="mini-dpad">
                                <div class="mini-btn up" data-btn="UP"></div>
                                <div class="mini-btn left" data-btn="LEFT"></div>
                                <div class="mini-btn center"></div>
                                <div class="mini-btn right" data-btn="RIGHT"></div>
                                <div class="mini-btn down" data-btn="DOWN"></div>
                            </div>
                            <div class="mini-middle">
                                <div class="mini-btn select" data-btn="SELECT">SE</div>
                                <div class="mini-btn start" data-btn="START">ST</div>
                            </div>
                            <div class="mini-ab">
                                <div class="mini-btn b-btn" data-btn="B">B</div>
                                <div class="mini-btn a-btn" data-btn="A">A</div>
                            </div>
                        </div>
                    </div>
                    <div class="player-input-panel" data-player="2">
                        <div class="input-panel-header">
                            <span class="panel-player-label p2">P2</span>
                            <span class="panel-latency" id="latency-p2">--ms</span>
                        </div>
                        <div class="mini-controller">
                            <div class="mini-dpad">
                                <div class="mini-btn up" data-btn="UP"></div>
                                <div class="mini-btn left" data-btn="LEFT"></div>
                                <div class="mini-btn center"></div>
                                <div class="mini-btn right" data-btn="RIGHT"></div>
                                <div class="mini-btn down" data-btn="DOWN"></div>
                            </div>
                            <div class="mini-middle">
                                <div class="mini-btn select" data-btn="SELECT">SE</div>
                                <div class="mini-btn start" data-btn="START">ST</div>
                            </div>
                            <div class="mini-ab">
                                <div class="mini-btn b-btn" data-btn="B">B</div>
                                <div class="mini-btn a-btn" data-btn="A">A</div>
                            </div>
                        </div>
                    </div>
                    <div class="player-input-panel" data-player="3">
                        <div class="input-panel-header">
                            <span class="panel-player-label p3">P3</span>
                            <span class="panel-latency" id="latency-p3">--ms</span>
                        </div>
                        <div class="mini-controller">
                            <div class="mini-dpad">
                                <div class="mini-btn up" data-btn="UP"></div>
                                <div class="mini-btn left" data-btn="LEFT"></div>
                                <div class="mini-btn center"></div>
                                <div class="mini-btn right" data-btn="RIGHT"></div>
                                <div class="mini-btn down" data-btn="DOWN"></div>
                            </div>
                            <div class="mini-middle">
                                <div class="mini-btn select" data-btn="SELECT">SE</div>
                                <div class="mini-btn start" data-btn="START">ST</div>
                            </div>
                            <div class="mini-ab">
                                <div class="mini-btn b-btn" data-btn="B">B</div>
                                <div class="mini-btn a-btn" data-btn="A">A</div>
                            </div>
                        </div>
                    </div>
                    <div class="player-input-panel" data-player="4">
                        <div class="input-panel-header">
                            <span class="panel-player-label p4">P4</span>
                            <span class="panel-latency" id="latency-p4">--ms</span>
                        </div>
                        <div class="mini-controller">
                            <div class="mini-dpad">
                                <div class="mini-btn up" data-btn="UP"></div>
                                <div class="mini-btn left" data-btn="LEFT"></div>
                                <div class="mini-btn center"></div>
                                <div class="mini-btn right" data-btn="RIGHT"></div>
                                <div class="mini-btn down" data-btn="DOWN"></div>
                            </div>
                            <div class="mini-middle">
                                <div class="mini-btn select" data-btn="SELECT">SE</div>
                                <div class="mini-btn start" data-btn="START">ST</div>
                            </div>
                            <div class="mini-ab">
                                <div class="mini-btn b-btn" data-btn="B">B</div>
                                <div class="mini-btn a-btn" data-btn="A">A</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="game-toolbar">
                    <button id="pause-btn" class="nes-btn">‚è∏ ÊöÇÂÅú</button>
                    <button id="reset-btn" class="nes-btn">üîÑ ÈáçÁΩÆ</button>
                    <button id="fullscreen-btn" class="nes-btn">‚õ∂ ÂÖ®Â±è</button>
                    <button id="exit-btn" class="nes-btn danger">‚úï ÈÄÄÂá∫</button>
                </div>

                <!-- ËÅäÂ§©Èù¢Êùø -->
                <div class="chat-panel" id="chat-panel">
                    <div class="chat-header">
                        <span>üí¨ ËÅäÂ§©</span>
                        <button id="voice-btn" class="voice-btn">üé§</button>
                        <button id="toggle-chat-btn" class="toggle-chat-btn">‚ñº</button>
                    </div>
                    <div class="chat-body">
                        <div class="chat-messages" id="chat-messages"></div>
                        <div class="chat-input-area">
                            <input type="text" id="chat-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." maxlength="100">
                            <button id="send-chat-btn" class="nes-btn mini">ÂèëÈÄÅ</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ÊåâÈîÆËÆæÁΩÆÈù¢Êùø -->
            <section id="controls-panel" class="panel controls-panel">
                <div class="panel-header">
                    <span class="panel-led"></span>
                    <h2>ÊåâÈîÆËÆæÁΩÆ</h2>
                    <button id="toggle-controls-btn" class="toggle-btn">‚ñº</button>
                </div>
                <div class="panel-body controls-body">
                    <div class="controls-tabs">
                        <button class="tab-btn active" data-tab="keyboard">‚å®Ô∏è ÈîÆÁõò</button>
                        <button class="tab-btn" data-tab="gamepad">üéÆ ÊâãÊüÑ</button>
                        <button class="tab-btn" data-tab="test">üîç ÊµãËØï</button>
                    </div>

                    <div id="keyboard-tab" class="tab-content active">
                        <p class="tab-hint">ÁÇπÂáªÊåâÈíÆÂêéÊåâ‰∏ãÊñ∞ÊåâÈîÆËøõË°å‰øÆÊîπ</p>
                        <div class="key-mapping-grid">
                            <div class="mapping-group">
                                <h4>ÊñπÂêëÈîÆ</h4>
                                <div class="mapping-row">
                                    <span class="key-label">‰∏ä</span>
                                    <button class="key-bind-btn" data-action="UP">W</button>
                                </div>
                                <div class="mapping-row">
                                    <span class="key-label">‰∏ã</span>
                                    <button class="key-bind-btn" data-action="DOWN">S</button>
                                </div>
                                <div class="mapping-row">
                                    <span class="key-label">Â∑¶</span>
                                    <button class="key-bind-btn" data-action="LEFT">A</button>
                                </div>
                                <div class="mapping-row">
                                    <span class="key-label">Âè≥</span>
                                    <button class="key-bind-btn" data-action="RIGHT">D</button>
                                </div>
                            </div>
                            <div class="mapping-group">
                                <h4>ÂäüËÉΩÈîÆ</h4>
                                <div class="mapping-row">
                                    <span class="key-label">A</span>
                                    <button class="key-bind-btn" data-action="A">J</button>
                                </div>
                                <div class="mapping-row">
                                    <span class="key-label">B</span>
                                    <button class="key-bind-btn" data-action="B">K</button>
                                </div>
                                <div class="mapping-row">
                                    <span class="key-label">SELECT</span>
                                    <button class="key-bind-btn" data-action="SELECT">U</button>
                                </div>
                                <div class="mapping-row">
                                    <span class="key-label">START</span>
                                    <button class="key-bind-btn" data-action="START">I</button>
                                </div>
                            </div>
                        </div>
                        <button id="reset-keys-btn" class="nes-btn mini">ÊÅ¢Â§çÈªòËÆ§</button>
                    </div>

                    <div id="gamepad-tab" class="tab-content">
                        <div class="gamepad-status">
                            <span class="gamepad-icon">üéÆ</span>
                            <span id="gamepad-status-text">Êú™Ê£ÄÊµãÂà∞ÊâãÊüÑ</span>
                        </div>
                        <div class="gamepad-visual">
                            <div class="gamepad-diagram">
                                <div class="gp-dpad">
                                    <div class="gp-btn up" data-btn="12">‚Üë</div>
                                    <div class="gp-btn left" data-btn="14">‚Üê</div>
                                    <div class="gp-btn right" data-btn="15">‚Üí</div>
                                    <div class="gp-btn down" data-btn="13">‚Üì</div>
                                </div>
                                <div class="gp-center">
                                    <div class="gp-btn select" data-btn="8">SEL</div>
                                    <div class="gp-btn start" data-btn="9">STA</div>
                                </div>
                                <div class="gp-face">
                                    <div class="gp-btn y" data-btn="3">Y</div>
                                    <div class="gp-btn x" data-btn="2">X</div>
                                    <div class="gp-btn b" data-btn="0">B</div>
                                    <div class="gp-btn a" data-btn="1">A</div>
                                </div>
                            </div>
                        </div>
                        <p class="gamepad-hint">ËøûÊé•ÊâãÊüÑÂêéÊåâ‰ªªÊÑèÈîÆÊøÄÊ¥ª</p>
                    </div>

                    <div id="test-tab" class="tab-content">
                        <p class="tab-hint">Êåâ‰∏ãÈîÆÁõòÊàñÊâãÊüÑÊåâÈîÆÊü•ÁúãÊïàÊûú</p>
                        <div class="test-display">
                            <div class="test-nes-controller">
                                <div class="nes-dpad">
                                    <div class="nes-btn-test up" data-test="UP"></div>
                                    <div class="nes-btn-test left" data-test="LEFT"></div>
                                    <div class="nes-btn-test center"></div>
                                    <div class="nes-btn-test right" data-test="RIGHT"></div>
                                    <div class="nes-btn-test down" data-test="DOWN"></div>
                                </div>
                                <div class="nes-middle">
                                    <div class="nes-btn-test select" data-test="SELECT">SELECT</div>
                                    <div class="nes-btn-test start" data-test="START">START</div>
                                </div>
                                <div class="nes-ab">
                                    <div class="nes-btn-test b-btn" data-test="B">B</div>
                                    <div class="nes-btn-test a-btn" data-test="A">A</div>
                                </div>
                            </div>
                        </div>
                        <div class="last-input">
                            <span>ÊúÄÂêéËæìÂÖ•:</span>
                            <span id="last-input-display">-</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- ËôöÊãüÊâãÊüÑÔºàÊâãÊú∫Á´ØÔºâ -->
        <div id="virtual-gamepad" class="virtual-gamepad hidden">
            <!-- Â∑¶‰æßÊñπÂêëÈîÆ -->
            <div class="vgp-left">
                <div class="vgp-dpad">
                    <button class="vgp-btn up" data-key="UP"></button>
                    <button class="vgp-btn left" data-key="LEFT"></button>
                    <button class="vgp-btn center"></button>
                    <button class="vgp-btn right" data-key="RIGHT"></button>
                    <button class="vgp-btn down" data-key="DOWN"></button>
                </div>
            </div>
            <!-- ‰∏≠Èó¥ÂäüËÉΩÈîÆ -->
            <div class="vgp-center">
                <button class="vgp-btn select" data-key="SELECT">SEL</button>
                <button class="vgp-btn start" data-key="START">STA</button>
            </div>
            <!-- Âè≥‰æßABÈîÆ -->
            <div class="vgp-right">
                <button class="vgp-btn b" data-key="B">B</button>
                <button class="vgp-btn a" data-key="A">A</button>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast hidden"></div>

        <footer class="console-footer">
            <div class="footer-vents">
                <span></span><span></span><span></span><span></span><span></span>
            </div>
        </footer>
    </div>

    <script src="https://unpkg.com/jsnes@1.2.1/dist/jsnes.min.js"></script>
    <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
